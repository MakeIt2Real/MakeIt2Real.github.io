<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Cannon Game</title>

  <!-- LINK CSS (THIS IS IMPORTANT) -->
  <link rel="stylesheet" href="style.css">
</head>
<body>

<h1>Cannon Game</h1>

<div class="panel">
  Difficulty:
  <select id="difficulty">
    <option value="N">Normal</option>
    <option value="E">Easy</option>
    <option value="M">Medium</option>
    <option value="H">Hard</option>
  </select>

  Gravity Speed:
  <input id="gravitySpeed" type="number" step="0.1" value="0.3">

  Bounce Walls:
  <input id="bounceWalls" type="checkbox">

  Enable Target:
  <input id="enableTarget" type="checkbox" checked>

  <button onclick="startGame()">Start / Restart</button>
</div>

<p class="controls">
Controls:<br>
⬆ / ⬇ Aim<br>
⬅ / ➡ Speed<br>
SPACE Shoot<br>
G Toggle Gravity<br>
R Restart
</p>

<canvas id="game" width="800" height="600"></canvas>

<script>
/* ================== SETUP ================== */
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

let bullets = [];
let target = null;
let enableTarget = true;

let gravityOn = false;
let gravitySpeed = 0.3;
let bounce = false;

let score = 0;
let round = 1;
let goal = 3;
let ammo = 20;
let ammoUsed = 20;

let gameState = "menu";

const cannon = {
  x: 40,
  y: 580,
  angle: 45,
  speed: 8
};

/* ================== TARGET ================== */
function spawnTarget() {
  if (!enableTarget) {
    target = null;
    return;
  }

  const diff = document.getElementById("difficulty").value;

  let size = 10;
  if (diff === "M") size = Math.random() * 12 + 8;
  if (diff === "H") size = Math.random() * 17 + 3;

  target = {
    x: Math.random() * 500 + 200,
    y: diff === "H" ? Math.random() * 400 : 550,
    size: size
  };
}

/* ================== START ================== */
function startGame() {
  bullets = [];
  score = 0;
  round = 1;
  goal = 3;
  ammo = 20;
  ammoUsed = ammo;

  gravityOn = false;
  gravitySpeed = parseFloat(document.getElementById("gravitySpeed").value);
  bounce = document.getElementById("bounceWalls").checked;
  enableTarget = document.getElementById("enableTarget").checked;

  gameState = "playing";
  spawnTarget();
}

/* ================== INPUT ================== */
document.addEventListener("keydown", e => {
  if (gameState !== "playing") {
    if (e.key === "r") startGame();
    return;
  }

  if (e.key === "ArrowUp") cannon.angle = Math.min(90, cannon.angle + 5);
  if (e.key === "ArrowDown") cannon.angle = Math.max(0, cannon.angle - 5);
  if (e.key === "ArrowLeft") cannon.speed--;
  if (e.key === "ArrowRight") cannon.speed++;
  if (e.key === "g") gravityOn = !gravityOn;

  if (e.code === "Space" && ammoUsed > 0) {
    bullets.push({
      x: cannon.x,
      y: cannon.y,
      vx: cannon.speed * Math.cos(cannon.angle * Math.PI / 180),
      vy: -cannon.speed * Math.sin(cannon.angle * Math.PI / 180),
      r: 5
    });
    ammoUsed--;
  }
});

/* ================== UPDATE ================== */
function update() {
  if (gameState !== "playing") return;

  for (let b of bullets) {
    if (gravityOn) b.vy += gravitySpeed;
    b.x += b.vx;
    b.y += b.vy;

    if (bounce) {
      if (b.y > 580) b.vy *= -0.7;
      if (b.x < 10 || b.x > 790) b.vx *= -0.7;
    }
  }

  bullets = bullets.filter(b => b.y < 600 && b.x > 0 && b.x < 800);

  if (target) {
    for (let b of bullets) {
      if (
        b.x > target.x &&
        b.x < target.x + target.size &&
        b.y > target.y &&
        b.y < target.y + target.size
      ) {
        score++;
        spawnTarget();
      }
    }
  }

  if (ammoUsed <= 0 && score < goal && enableTarget) {
    gameState = "lose";
  }

  if (score >= goal && enableTarget) {
    score -= goal;
    round++;
    goal += 2;
    ammo += 2;
    ammoUsed = ammo;

    if (round > 5) gameState = "win";
  }
}

/* ================== DRAW ================== */
function draw() {
  ctx.clearRect(0, 0, 800, 600);

  if (target) {
    ctx.fillStyle = "green";
    ctx.fillRect(target.x, target.y, target.size, target.size);
  }

  ctx.fillStyle = "purple";
  ctx.fillRect(cannon.x - 5, cannon.y, 10, 15);

  ctx.strokeStyle = "red";
  ctx.beginPath();
  ctx.moveTo(cannon.x, cannon.y);
  ctx.lineTo(
    cannon.x + 30 * Math.cos(cannon.angle * Math.PI / 180),
    cannon.y - 30 * Math.sin(cannon.angle * Math.PI / 180)
  );
  ctx.stroke();

  ctx.fillStyle = "white";
  for (let b of bullets) {
    ctx.beginPath();
    ctx.arc(b.x, b.y, b.r, 0, Math.PI * 2);
    ctx.fill();
  }

  ctx.fillText(`Score: ${score}`, 10, 20);
  ctx.fillText(`Round: ${round}`, 10, 40);
  ctx.fillText(`Ammo: ${ammoUsed}`, 10, 60);

  if (gameState === "win" || gameState === "lose") {
    ctx.fillStyle = "rgba(0,0,0,0.7)";
    ctx.fillRect(0, 0, 800, 600);
    ctx.fillStyle = "white";
    ctx.font = "40px Arial";
    ctx.textAlign = "center";
    ctx.fillText(gameState === "win" ? "YOU WIN!" : "YOU LOSE!", 400, 300);
    ctx.font = "20px Arial";
    ctx.fillText("Press R or Restart", 400, 340);
    ctx.textAlign = "left";
  }
}

/* ================== LOOP ================== */
function loop() {
  update();
  draw();
  requestAnimationFrame(loop);
}

loop();
</script>

</body>
</html>
